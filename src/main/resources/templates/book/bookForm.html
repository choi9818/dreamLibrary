<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  	  layout:decorate="~{layouts/layout}">

<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">
	<script th:inline="javascript">
		// 도서등록시 실패메시지를 받아서 도서등록페이지에 재진입시 alert을 통해 실패 사유를 보여줌
		$(document).ready(function() {
			var errorMessage = [[${errorMessage}]];
			if(errorMessage != null) {
				alert(errorMessage);
			}
			bindDomEvent();
		});
		
		// 파일 첨부시 이미지파일인지 검사
		function bindDomEvent() {
			$("#formFile").on("change", function() {
				var fileName = $(this).val().split("\\").pop();
				var fileExt = fileName.substring(fileName.lastIndexOf(".") + 1);
				fielExt = fileExt.toLowerCase();
				
				if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp") {
					alert("이미지파일만 등록이 가능합니다.");
					return;
				}
				
				$(this).siblings("#formFile").html(fileName);
			});
		}
	</script>
</th:block>

<!-- 사용자 css 추가 -->
<div layout:fragment="css">
	<style>
    	#book-element { width: 10%; }
    	#book-element-content { width: 40%; padding-left: 3px;}
    	.input-group-text { width: 82px; font-size: 0.8em;}
    	.fieldError { color: #bd2130; }
    </style>
</div>

<!-- content -->
<div layout:fragment="content" style="width: 75%; margin: 0 auto">
  <form role="form" method="post" enctype="multipart/form-data" th:object="${bookFormDto}">
    <h3 align="center">도서 관리</h3>
    <!-- table -->
    <div class="table-responsive">
      <table class="table table-borderless">
        <tbody>
          <tr>
          	<td id="book-element">
          	  <div class="mb-3"><label for="defaultFormControlInput" class="form-label">도서명</label></div>
          	</td>
          	<td colspan='3' id="book-element-content">
          	  <div class="mb-3">
          	    <input type="text" th:field="*{title}" class="form-control" id="defaultFormControlInput" placeholder="" aria-describedby="defaultFormControlHelp" />
          	  </div>
          	</td> 
            <p th:if="${#fields.hasErrors('title')}" th:errors="*{title}" class="fieldError">Incorrect data</p>
          </tr>
          
          <tr>
            <td id="book-element">
              <div class="mb-3"><label for="defaultFormControlInput" class="form-label">ISBN</label></div>
            </td>
            <td id="book-element-content">
              <div class="mb-3">
          	    <input type="text" th:field="*{isbn}" class="form-control" id="defaultFormControlInput" placeholder="" aria-describedby="defaultFormControlHelp" />
          	  </div>
            </td>
            <td id="book-element">
              <div class="mb-3"><label for="defaultFormControlInput" class="form-label">저자</label></div>
            </td>
            <td id="book-element-content">
              <div class="mb-3">
          	    <input type="text" th:field="*{author}" class="form-control" id="defaultFormControlInput" placeholder="" aria-describedby="defaultFormControlHelp" />
          	  </div>
            </td>
          </tr>
          <p th:if="${#fields.hasErrors('isbn')}" th:errors="*{isbn}" class="fieldError">Incorrect data</p>
          
          <tr>
            <td id="book-element">
              <div class="mb-3"><label for="defaultFormControlInput" class="form-label">카테고리</label></div>
            </td>
	        <td id="book-element-content">
	          <div class="mb-3">
	            <select th:field="*{category}" class="form-select" id="exampleFormControlSelect1" aria-label="Default select example">
			      <option value="소설">소설</option>
			      <option value="시/에세이">시/에세이</option>
			      <option value="인문">인문</option>
			      <option value="경제/경영">경제/경영</option>
			      <option value="가정/육아">가정/육아</option>
			      <option value="요리">요리</option>
			      <option value="건강">건강</option>
			      <option value="취미/실용/스포츠">취미/실용/스포츠</option>
			      <option value="자기계발">자기계발</option>
			      <option value="컴퓨터/IT">컴퓨터/IT</option>
			      <option value="정치/사회">정치/사회</option>
			      <option value="역사/문화">역사/문화</option>
			      <option value="종교">종교</option>
			      <option value="예술/대중문">예술/대중문화</option>
			      <option value="기술/공학">기술/공학</option>
			      <option value="과학">과학</option>
			      <option value="청소년">청소년</option>
			      <option value="유아">유아</option>
			      <option value="어린이">어린이</option>
  			    </select>
	          </div>
	        </td>
            <td id="book-element">
              <div class="mb-3"><label for="defaultFormControlInput" class="form-label">열람실</label></div>
            </td>
  	        <td id="book-element-content">
  	          <div class="mb-3">
	            <select th:field="*{place}" class="form-select" id="exampleFormControlSelect1" aria-label="Default select example">
			      <option value="1열람실">1열람실</option>
			      <option value="2열람실">2열람실</option>
			      <option value="3열람실">3열람실</option>
			      <option value="4열람실">4열람실</option>
			      <option value="5열람실">5열람실</option>
			      <option value="6열람실">6열람실</option>
			      <option value="7열람실">7열람실</option>
			      <option value="8열람실">8열람실</option>
			      <option value="9열람실">9열람실</option>
  			    </select>
	          </div>
	        </td>
          </tr>
          
          <tr>
	        <td id="book-element">
	          <div class="mb-3"><label for="defaultFormControlInput" class="form-label">발행처</label></div>
	        </td>
	        <td id="book-element-content">
	          <div class="mb-3">
	            <input type="text" th:field="*{publisher}" class="form-control" id="defaultFormControlInput" placeholder="" aria-describedby="defaultFormControlHelp" />
	          </div>
	        </td>
	        <td id="book-element">
	          <div class="mb-3"><label for="defaultFormControlInput" class="form-label">발행일자</label></div>
	        </td>
	        <td id="book-element-content">
	          <div class="mb-3">
				<input class="form-control" type="date" value="2022-01-01" id="html5-date-input" th:field="*{publishedDate}"/>
	          </div>
	        </td>
          </tr>
 
	      <tr>
	        <td id="book-element">
	          <div class="mb-3"><label for="defaultFormControlInput" class="form-label">예약상태</label></div>
	        </td>
	        <td id="book-element-content">
	          <div class="mb-3">
	            <select th:field="*{bookStatus}" class="form-select" id="exampleFormControlSelect1" aria-label="Default select example">
			      <option value="POSSIBLE">예약가능</option>
			      <option value="IMPOSSIBLE">예약불가능</option>
  			    </select>
	          </div>
	        </td>
			<td id="book-element">
			  <div class="mb-3"><label for="defaultFormControlInput" class="form-label">가능횟수</label></div>
			</td>
	        <td id="book-element-content">
	          <div class="mb-3">
	            <input type="number" th:field="*{count}" class="form-control" id="defaultFormControlInput" placeholder="3" aria-describedby="defaultFormControlHelp" />
	          </div>
	        </td>
	      </tr>
		  
	      <tr>
	        <td id="book-element">
	          <div class="mb-3"><label for="defaultFormControlInput" class="form-label">이미지</label></div>
	        </td>
	        <td colspan='3' id="book-element-content">
	          <div class="mb-3" th:if="${#lists.isEmpty(bookFormDto.bookImgDtoList)}">
	            <div class="custom-file">
	              <input class="form-control" type="file" id="formFile" name="bookImgFile">
	            </div>
	          </div>
	          <div class="mb-3" th:if="${not #lists.isEmpty(bookFormDto.bookImgDtoList)}">
	            <div class="custom-file" th:each="bookImgDto, status: ${bookFormDto.bookImgDtoList}">
	              <input class="form-control" type="file" id="formFile" name="bookImgFile"
	              		 th:text="${not #strings.isEmpty(bookImgDto.oriImgName)} ? ${bookImgDto.oriImgName} : '도서 이미지' + ${status.index+1}">
	              <input type="hidden" name="bookImgIds" th:value="${bookImgDto.id}">
	            </div>
	          </div>
	        </td>
	      </tr>
	      
	      <tr>
	        <td id="book-element">
	          <div class="mb-3"><label for="defaultFormControlInput" class="form-label">상세설명</label></div>
	        </td>
	        <td colspan='3' id="book-element-content">
	          <div class="mb-3">
	            <textarea th:field="*{bookDetail}" class="form-control" id="exampleFormControlTextarea1" rows="5"></textarea>
	          </div>
	        </td>
	      </tr>
        </tbody>
      </table>
    </div>
    
    <div class="button-group" align="center">
      <div th:if="${#strings.isEmpty(bookFormDto.isbn)}">
        <button type="submit" class="btn btn-primary" th:formaction="@{/admin/book/new}">등록</button>
	    <button type="button" class="btn btn-outline-primary">취소</button>
      </div>
      <div th:unless="${#strings.isEmpty(bookFormDto.isbn)}">
        <button type="submit" class="btn btn-primary" th:formaction="@{'/admin/book/' + ${bookFormDto.isbn}}">수정</button>
	    <button type="button" class="btn btn-outline-primary">취소</button>
      </div>
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    </div>
    
  </form>
</div>

</html>