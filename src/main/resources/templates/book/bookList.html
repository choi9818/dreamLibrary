<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  	  layout:decorate="~{layouts/layout2}">

<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">
	<script th:inline="javascript">
		$(document).ready(function() {
			$("#searchBtn").on("click", function(e) {
				e.preventDefault();
				page(0);
			});
		});
		
		function page(page) {
			var searchBy = $("#searchBy").val();
			var searchQuery = $("#searchQuery").val();
			
			location.href="/search/integrated/" + page 
						 + "?searchBy=" + searchBy + "&searchQuery=" + searchQuery;
		}
	</script>
</th:block>

<!-- 사용자 css 추가 -->
<th:block layout:fragment="css">
	<style>
		#searchBtn { border: none; }
		.form-select { border: 0px; width: 15%; }
	</style>
</th:block>

<!-- content -->
<div layout:fragment="content" style="width: 75%; margin: 0 auto;">
  <form th:action="@{'/search/integrated/' + ${books.number}}" role="form" method="get" th:object="${books}">
    
    <!-- 검색창 -->
    <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar"
    	 th:object="${bookSearchDto}">
      <select class="form-select" id="exampleFormControlSelect1" th:field="*{searchBy}">
        <option value="title">도서명</option>
    	<option value="author">저자</option>
    	<option value="publisher">출판사</option>
      </select>
      <input type="text" class="form-control border-0 shadow-none" placeholder="통합검색" th:field="*{searchQuery}">
      <input type="hidden" th:value="${bookSearchDto.searchBy}" id="searchBy">
      <input type="hidden" th:value="${bookSearchDto.searchQuery}" id="searchQuery">
      <button type="submit" class="btn btn-icon me-2 btn-outline-primary" id="searchBtn">
        <span class="tf-icons bx bx-search fs-4 lh-0"></span>
      </button>
      
    </nav>

    <!-- 도서목록 -->
    <div class="row row-cols-1 row-cols-md-3 g-4">
      <th:block th:each="book, status: ${books.getContent()}">
        <div class="col">
          <div class="card h-100">
            <a th:href="'/search/bookdtl/' + ${book.isbn}">
              <img th:src="${book.imgUrl}" th:alt="${book.title}" class="card-img-top" />
              <div class="card-body">
                <h4 class="card-title">[[${book.title}]]</h4>
                <p class="card-text">[[${book.category}]]</p>
                <p class="card-text">[[${book.author}]]<small class="text-muted">&nbsp;지음</small></p>
                <p class="card-text">[[${book.publisher}]]<small class="text-muted">&nbsp;펴냄</small></p>
                <p class="card-text">[[${book.publishedDate}]]<small class="text-muted">&nbsp;출간</small></p>
                <div th:if="${#strings.equals(book.bookStatus, 'POSSIBLE')}">
                  <p class="card-text"><span class="badge rounded-pill bg-label-info">대출예약가능</span></p>
                </div>
                <div th:unless="${#strings.equals(book.bookStatus, 'POSSIBLE')}">
                  <p class="card-text"><span class="badge rounded-pill bg-label-danger">대출예약불가</span></p>
                </div>
              </div>
            </a>
          </div>
        </div>
      </th:block>
    </div>
    
    <!-- 페이지네이션 -->
	<div th:with="start=${(books.number/maxPage)*maxPage + 1},
				  end=(${(books.totalPages == 0) ? 1 : (start + (maxPage - 1) < books.totalPages ? start + (maxPage - 1) : books.totalPages)})">
	  <nav aria-label="Page navigation">
	    <ul class="pagination justify-content-center">
	      <li class="page-item first" th:classappend="${books.first}?'disabled'">
	        <a class="page-link" href="#" th:onclick="'javascript:page(' + 0 + ')'"><i class="bx bx-chevrons-left"></i></a>
	      </li>
	      <li class="page-item prev" th:classappend="${books.number eq 0}?'disabled':''">
	        <a class="page-link" th:onclick="'javascript:page(' + ${books.number -1} + ')'"><i class="bx bx-chevron-left"></i></a>
	      </li>
	      <li class="page-item" th:each="page: ${#numbers.sequence(start, end)}"
	      	  th:classappend="${books.number eq page-1}?'active':''">
	        <a th:onclick="'javascript:page(' + ${page - 1} + ')'" th:inline="text" class="page-link">[[${page}]]</a>
	      </li>
	      <li class="page-item next" th:classappend="${books.last}?'disabled'">
	        <a class="page-link" href="#" th:onclick="'javascript:page(' + ${books.number + 1} + ')'"><i class="bx bx-chevron-right"></i></a>
	      </li>
	      <li class="page-item last" th:classappend="${books.last}?'disabled'">
	        <a class="page-link" href="#" th:onclick="'javascript:page(' + ${books.totalPages - 1} + ')'"><i class="bx bx-chevrons-right"></i></a>
	      </li>
	    </ul>
	  </nav>			  
	</div>
  </form>
</div>

</html>