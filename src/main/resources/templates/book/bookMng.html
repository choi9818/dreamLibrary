<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  	  layout:decorate="~{layouts/layout}">
  	  
<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">
	<script th:inline="javascript">
		$(document).ready(function() {
			$("#searchBtn").on("click", function(e) {
				e.preventDefault();
				page(0);
			});
		});
		
		function page(page) {
			var searchBy = $("#searchBy").val();
			var searchQuery = $("#searchQuery").val();
			
			location.href="/admin/books/" + page 
						 + "?searchBy=" + searchBy + "&searchQuery=" + searchQuery;
		}
	</script>
</th:block>

<!-- 사용자 css 추가 -->
<th:block layout:fragment="css">
	<style>
		#smallSelect { width: 100px; margin-right: 5px; float: left; }
		#smallInput { width: 250px; margin-right: 5px; float: left; }
	</style>
</th:block>

<!-- content -->
<div layout:fragment="content" style="width: 75%; margin: 0 auto">
  <form th:action="@{'/admin/books/' + ${books.number}}" role="form" method="get" th:object="${books}">
    <div class="table-responsive">
      <table class="table table-sm table-hover">
        <thead>
          <tr>
            <th>ISBN</th>
            <th>카테고리</th>
            <th>도서명</th>
            <th>저자</th>
            <th>출판사</th>
            <th>출판일자</th>
            <th>예약가능횟수</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="book, status: ${books.getContent()}">
            <td th:text="${book.isbn}"></td>
            <td th:text="${book.category}"></td>
            <td><a th:href="'/admin/book/' + ${book.isbn}" th:text="${book.title}"></a></td>
            <td th:text="${book.author}"></td>
            <td th:text="${book.publisher}"></td>
            <td th:text="${book.publishedDate}"></td>
            <td th:text="${book.count}"></td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- 페이지네이션 -->
    <div th:with="start=${(books.number/maxPage)*maxPage + 1},
    			  end=(${(books.totalPages == 0) ? 1 : 
    			      (start + (maxPage - 1) < books.totalPages ? start + (maxPage - 1) : books.totalPages)})">
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
          <li class="page-item first" th:classappend="${books.first}?'disabled'">
            <a class="page-link" th:onclick="'javascript:page(' + 0 + ')'"><i class="bx bx-chevrons-left"></i></a>
          </li>
          <li class="page-item prev" th:classappend="${books.first}?'disabled'">
            <a class="page-link" th:onclick="'javascript:page(' + ${books.number - 1} + ')'"><i class="bx bx-chevron-left"></i></a>
          </li>
          <li class="page-item" th:each="page: ${#numbers.sequence(start, end)}"
          	  th:classappend="${books.number eq page-1}?'active':''">
            <a th:onclick="'javascript:page(' + ${page - 1} + ')'" th:inline="text" class="page-link">[[${page}]]</a>
          </li>
          <li class="page-item next" th:classappend="${books.last}?'disabled'">
            <a class="page-link" th:onclick="'javascript:page(' + ${books.number + 1} + ')'"><i class="bx bx-chevron-right"></i></a>
          </li>
          <li class="page-item last" th:classappend="${books.last}?'disabled'">
            <a class="page-link" th:onclick="'javascript:page(' + ${books.totalPages - 1} + ')'"><i class="bx bx-chevrons-right"></i></a>
          </li>
        </ul>
      </nav>
    </div>
    
    <!-- 조회 -->
    <div th:object="${bookSearchDto}" class="pagination justify-content-center">
      <select th:field="*{searchBy}" class="form-select form-select-sm" id="smallSelect">
        <option value="title">도서명</option>
        <option value="isbn">ISBN</option>
        <option value="author">저자</option>
        <option value="publisher">출판사</option>
        <option value="category">카테고리</option>
      </select>
      <input th:field="*{searchQuery}" type="text" class="form-control form-control-sm" id="smallInput" placeholder=""/>
      <button id="searchBtn" type="submit" class="btn btn-sm btn-primary">조회</button>
      <input type="hidden" th:value="${bookSearchDto.searchBy}" id="searchBy">
      <input type="hidden" th:value="${bookSearchDto.searchQuery}" id="searchQuery">
    </div>
  </form>
</div>
</html>